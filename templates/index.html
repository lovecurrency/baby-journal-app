{% extends "base.html" %}

{% block title %}Home - Baby Activity Journal{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        {% if profile %}
            <div class="text-center mb-4">
                <h2>
                    <i class="bi bi-person-heart"></i> {{ profile.name }}'s Journal
                </h2>
                <p class="text-muted">
                    Age: {{ profile.age_months }} months ({{ profile.age_days }} days)
                    {% if profile.gender %}
                        | Gender: {{ profile.gender }}
                    {% endif %}
                </p>
            </div>
        {% else %}
            <div class="alert alert-info text-center">
                <h4>Welcome to Baby Activity Journal!</h4>
                <p>Get started by setting up your baby's profile.</p>
                <a href="{{ url_for('setup') }}" class="btn btn-custom">
                    <i class="bi bi-person-plus"></i> Setup Baby Profile
                </a>
            </div>
        {% endif %}
    </div>
</div>

{% if statistics and statistics.total_activities > 0 %}
<div class="row mb-4">
    <div class="col-md-3">
        <div class="stat-card text-center">
            <h3>{{ statistics.total_activities }}</h3>
            <p class="mb-0">Total Activities</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card text-center">
            <h3>{{ statistics.daily_averages.feedings|default(0) }}</h3>
            <p class="mb-0">Daily Feedings (Avg)</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card text-center">
            <h3>{{ statistics.daily_averages.diaper_changes|default(0) }}</h3>
            <p class="mb-0">Daily Diapers (Avg)</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card text-center">
            <h3>{{ statistics.daily_averages.sleep_sessions|default(0) }}</h3>
            <p class="mb-0">Daily Sleep (Avg)</p>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <div class="col-md-8">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4><i class="bi bi-clock-history"></i> Recent Activities</h4>
            <div>
                <a href="{{ url_for('quick_add') }}" class="btn btn-sm btn-custom">
                    <i class="bi bi-plus"></i> Add Activity
                </a>
                <a href="{{ url_for('upload_whatsapp') }}" class="btn btn-sm btn-success">
                    <i class="bi bi-whatsapp"></i> Import WhatsApp
                </a>
            </div>
        </div>

        {% if recent_activities %}
            {% for activity in recent_activities %}
            <div class="activity-card">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <span class="category-badge category-{{ activity.category }}">
                            {{ activity.category|capitalize }}
                        </span>
                        <small class="text-muted ms-2">{{ activity.timestamp_formatted }}</small>
                    </div>
                    {% if activity.sender %}
                        <small class="text-muted">by {{ activity.sender }}</small>
                    {% endif %}
                </div>
                <p class="mt-2 mb-1">
                    <strong>{{ activity.activity_type|replace('_', ' ')|title }}</strong>
                </p>
                <p class="mb-0 text-muted">{{ activity.description[:100] }}{% if activity.description|length > 100 %}...{% endif %}</p>
                {% if activity.amount %}
                    <small class="text-primary">
                        Quantity: {{ activity.amount }} {{ activity.unit|default('') }}
                    </small>
                {% endif %}
                {% if activity.duration_minutes %}
                    <small class="text-info ms-2">
                        Duration: {{ activity.duration_minutes }} minutes
                    </small>
                {% endif %}
            </div>
            {% endfor %}

            <div class="text-center mt-3">
                <a href="{{ url_for('activities') }}" class="btn btn-outline-primary">
                    View All Activities <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        {% else %}
            <div class="alert alert-light text-center">
                <i class="bi bi-journal-text" style="font-size: 3rem; color: #ddd;"></i>
                <p class="mt-3">No activities recorded yet.</p>
                <p>Start by adding an activity or importing your WhatsApp chat!</p>
            </div>
        {% endif %}
    </div>

    <div class="col-md-4">
        <h4><i class="bi bi-lightning"></i> Quick Actions</h4>
        <div class="d-grid gap-2">
            <a href="{{ url_for('daily_activities') }}" class="btn btn-custom" style="background: linear-gradient(135deg, #a29bfe, #6c5ce7);">
                <i class="bi bi-stars"></i> Today's Activities
            </a>
            <button class="btn btn-outline-primary" onclick="quickLog('feeding')">
                <i class="bi bi-cup-straw"></i> Log Feeding
            </button>
            <button class="btn btn-outline-info" onclick="quickLog('diaper')">
                <i class="bi bi-droplet"></i> Log Diaper Change
            </button>
            <button class="btn btn-outline-purple" onclick="quickLog('sleep')">
                <i class="bi bi-moon"></i> Log Sleep
            </button>
            <button class="btn btn-outline-success" onclick="quickLog('milestone')">
                <i class="bi bi-star"></i> Log Milestone
            </button>
        </div>

        {% if statistics.by_category %}
        <h4 class="mt-4"><i class="bi bi-pie-chart"></i> Activity Distribution</h4>
        <div class="list-group">
            {% for category, count in statistics.by_category.items() %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
                <span class="category-badge category-{{ category }}">
                    {{ category|capitalize }}
                </span>
                <span class="badge bg-secondary rounded-pill">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

<script>
function quickLog(type) {
    const messages = {
        'feeding': 'Baby fed 150ml bottle',
        'diaper': 'Changed wet diaper',
        'sleep': 'Baby took a nap for 1 hour',
        'milestone': 'Baby smiled and laughed'
    };

    const message = prompt(`Log ${type} activity:`, messages[type]);
    if (message) {
        fetch('/api/activity', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                message: message,
                sender: 'Quick Log'
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Failed to log activity');
            }
        });
    }
}
</script>
{% endblock %}